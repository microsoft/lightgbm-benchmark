# to execute, run from /pipelines/azureml/
# > python pipelines/lightgbm_training.py --config-dir ./conf --config-name experiments/benchmarks/benchmark-cpu-vs-gpu run.submit=True

defaults:
  - aml: sample
  - compute: sample
  - modules: benchmark

# run parameters are command line arguments for running your experiment
run: # params for running pipeline
  experiment_name: "benchmark-lightgbm-training" # IMPORTANT
  regenerate_outputs: false
  continue_on_failure: false
  verbose: false
  submit: false
  resume: false
  canary: false
  silent: false
  wait: false

module_loader: # module loading params
  use_local: "*"
  force_default_module_version: null
  force_all_module_version: null
  local_steps_folder: "../../../../../src/scripts/"

### CUSTOM PARAMETERS ###

lightgbm_training:
  benchmark_name: "benchmark-gpu-vs-cpu"

  # list all the train/test pairs to train on
  tasks:
    - train_dataset: "synthetic-regression-10cols-100000samples-train"
      test_dataset: "synthetic-regression-10cols-10000samples-test"
    - train_dataset: "synthetic-regression-100cols-100000samples-train"
      test_dataset: "synthetic-regression-100cols-10000samples-test"
    - train_dataset: "synthetic-regression-1000cols-100000samples-train"
      test_dataset: "synthetic-regression-1000cols-10000samples-test"

  # reference settings for the benchmark
  # all variants will be based on this
  reference_training:
    # TRAINING
    objective: "regression"
    metric: "rmse"
    boosting: "gbdt"
    tree_learner: "data"
    num_iterations: 100
    num_leaves: 31
    min_data_in_leaf: 20
    learning_rate: 0.1
    max_bin: 255
    feature_fraction: 1.0
    register_model: True # "{prefix}-{objective}-{cols}cols-{num_iterations}trees-{num_leaves}leaves"
    register_model_prefix: "synthetic-regression"
    register_model_suffix: "cpu"

    # COMPUTE PARAMS
    #target: null
    device_type: "cpu"
    nodes: 1
    processes: 1

  # variant settings override what is in reference_training
  variants:
    - device_type: "gpu"
      register_model_suffix: "gpu"
      override_docker: "../../../../../src/scripts/lightgbm_python/dockers/lightgbm_gpu_pip.dockerfile"
